OWNER=ovh
MAILCMD="/usr/sbin/sendmail $OWNER"
LOGROOT=/network/qwentes/produits/SOLV_032/SOHO_01237/LOGS_01237

LOGDATE=$(date)
LOGMONTH=$(date -d "$LOGDATE" +%m)
LOGYEAR=$(date -d "$LOGDATE" +%Y)
LOGPATH=$LOGROOT/$LOGYEAR/$LOGMONTH
if [ ! -e $LOGPATH ]
then
	echo "$LOGPATH Not Found... Creating it"
	mkdir -p $LOGPATH
fi

LOGSTAMP=$(date -d "$LOGDATE" +%s)
LOGFILE=$LOGPATH/$LOGSTAMP.log

cat mailheaders                                 >  $LOGFILE
echo "Subject: Request report for $@"       >> $LOGFILE
echo ""                                         >> $LOGFILE
echo "<x-charset iso-8859-1>Please read information at the end of the mail"                >> $LOGFILE

for SITE in $@
do
	TMPFILE=tmp/$SITE.$LOGSTAMP
	echo processing $TMPFILE
	TMPLIST=$TMPFILE.list
	TMPLOG=$TMPFILE.log
	TMPREP=$TMPFILE.report

	echo "Processing request for $SITE"		>> $LOGFILE
	echo -n "                   - Start: "		>> $LOGFILE
	date						>> $LOGFILE


	sitecopy -ll $SITE > $TMPLIST
	sitecopy -uk $SITE > $TMPLOG
	sitecopy -ll $SITE > $TMPREP


	echo -n "                   - Stop: "		>> $LOGFILE
	date						>> $LOGFILE 
	echo ""						>> $LOGFILE
	./progress.sh $SITE.$LOGSTAMP | sed s/sitecopy://	>> $LOGFILE
	echo ""						>> $LOGFILE
	echo "--- Begin error list (*)"			>> $LOGFILE
	cat $TMPFILE.report | grep ^item | grep -v /$ | sed "s/^item|//" >> $LOGFILE
	echo "--- End error list --------------------"	>> $LOGFILE
	echo ""						>> $LOGFILE

	TMPFILESTODELETE="$TMPFILESTODELETE $TMPLIST $TMPLOG $TMPREP"
#	rm -f $TMPFILE.*
done 

echo ""                                         >> $LOGFILE
cat mailtext                                    >> $LOGFILE
echo "</x-charset>"                             >> $LOGFILE

cat $LOGFILE | $MAILCMD

# cat tmp/*.log >> $LOGFILE

#rm -f $TMPFILESTODELETE
