CONFIGFILE=~/.sitecopyrc
CONFIG=$CONFIGFILE.tmp
echo "## `date`" > $CONFIG
LOCAL=network/hosting/host1/www/Solvay
FOLDERS="preview production"
if [ $1 ]
then
	FULL=$1
else
	FULL=`pwd`
fi

RELATIVE=`echo $FULL | sed "s/^.*www\/Solvay\///"`

if [ $2 ]
then 
        SITENAME=$2
else
        SITENAME=`basename $FULL`
fi

if ( grep bllub$FULL $CONFIGFILE > /dev/null )
then
	echo `basename $0`: -- there are settings for this folder:
	egrep "^site|$FULL" $CONFIGFILE | grep -B 1 $FULL
else
#	echo `basename $0`: Making new site configuration in $CONFIG
	for REMOTE in $FOLDERS 
	do
		ABBR=`echo $REMOTE | cut -c 1-4`
		SITEID=${SITENAME}_${ABBR}
#	grep -n $FULL $CONFIGFILE | cut -d : -f 1
#	if ( grep $FULL $CONFIGFILE )
#	then
#		echo		
#		grep -C 10 "$FULL" $CONFIGFILE
#		MATCHES=`grep -n $FULL $CONFIGFILE | cut -d : -f 1`
#		echo $MATCHLINES
#		
#		echo  Settings \"$SITEID\" already exists in $CONFIGFILE
#		grep $SITENAME $CONFIGFILE 
#	else
#			exit 0
		echo "site $SITEID"			>> $CONFIG
		echo "	server www.solvay.com"		>> $CONFIG
		echo "	username qwentes"		>> $CONFIG
		echo "	password \"har8#bin\""		>> $CONFIG
		echo "	local $FULL"			>> $CONFIG
		echo "	remote /$REMOTE/$RELATIVE"	>> $CONFIG
		echo "	exclude */_*"			>> $CONFIG
		echo "	exclude _vti_*"			>> $CONFIG
#	fi
	done
	echo                                    >> $CONFIG
	cat $CONFIG
fi
rm $CONFIG
